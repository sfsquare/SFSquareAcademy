@using SFSAcademy.Models
@{
    IEnumerable<SFSAcademy.BATCH> batches = (IEnumerable<SFSAcademy.BATCH>)ViewData["batches"];
    TIMETABLE_ENTRY timetable = (TIMETABLE_ENTRY)ViewData["timetable"];
}
@{
    ViewBag.Title = "New";
}
<script type="text/javascript" src="@Url.Content("~/Content/javascripts/jquery/jquery.min.js")"></script>
<script type="text/javascript" src="@Url.Content("~/Content/javascripts/jquery/jquery-ui.min.js")"></script>
<script type="text/javascript" src="@Url.Content("~/Content/javascripts/jquery/jquery-1.9.1.js")"></script>
<script type="text/javascript" src="@Url.Content("~/Content/javascripts/jquery/jquery-ui.js")"></script>
<link rel="stylesheet" href="~/Content/stylesheets/_styles/jquery-ui.css" />
<link rel="stylesheet" href="~/Content/stylesheets/timetable/new_timetable.css" />
<script type="text/javascript">
    $(document.forms[0]).ready(function () {
        $(".LoaderBox").hide();
        $('#BatchDropDown').change(function () {

            /* Get the selected value of dropdownlist */
            var selectedID = $(this).val();
            var SelectedTTId = $('#timetable_id').val();
            $(".LoaderBox").show();
            /* Request the partial view with .get request. */
            $.get('/Timetable_Entries/New_Entry?batch_id=' + selectedID + "&timetable_id=" + SelectedTTId, function (data) {

                /* data is the pure html returned from action method, load it to your page */
                $('#render_area').html(data);
                /* little fade in effect */
                $('#render_area').fadeIn('fast');
            }).success(function (status) {
                $(".LoaderBox").hide();
            });

        });
    });

    $(function () {
        $("#datepicker").datepicker({
            showOn: "button",
            buttonImage: "/Content/images/calendar_date_select/calendar.gif",
            dateFormat: 'dd-mm-yy',
            buttonImageOnly: true
        });
        $("#datepicker2").datepicker({
            showOn: "button",
            buttonImage: "/Content/images/calendar_date_select/calendar.gif",
            dateFormat: 'dd-mm-yy',
            buttonImageOnly: true
        });
    });

    var selected_divs = new Array();

    function update_selected_divs(id) {
        var exists_in_list = 0;
        for (x in selected_divs)
            if (id == selected_divs[x]) {
                exists_in_list = 1;
                selected_divs.splice(x, 1)
                $('drop_' + id).className = "drop";
            }
        if (!exists_in_list) {
            $('drop_' + id).className = "selected_div";
            selected_divs.push(id);
        }
    }

    function clear_selected_divs() {
        selected_divs = [];
    }

    function make_ajax_calls(tte_id, emp_sub_id) {
        if (selected_divs.length == 0) {
            var SelectedTTId = $('#timetable_id').val();
            $.get('/Timetable_Entries/update_multiple_timetable_entries2?emp_sub_id=' + emp_sub_id + "&tte_ids=" + tte_id + "&timetable_id=" + SelectedTTId, function (data) {

                /* data is the pure html returned from action method, load it to your page */
                $('#modal-box').html(data);
                /* little fade in effect */
                $('#modal-box').fadeIn('fast');
            }).success(function (status) {
                $(".LoaderBox2").hide();
                clear_selected_divs();
            });
        }
        else if (selected_divs.length == 1) {
            var SelectedTTId = $('#timetable_id').val();
            $.get('/Timetable_Entries/update_multiple_timetable_entries2?emp_sub_id=' + emp_sub_id + "&tte_ids=" + tte_id + "&timetable_id=" + SelectedTTId, function (data) {

                /* data is the pure html returned from action method, load it to your page */
                $('#modal-box').html(data);
                /* little fade in effect */
                $('#modal-box').fadeIn('fast');
            }).success(function (status) {
                $(".LoaderBox2").hide();
                clear_selected_divs();
            });
            if (selected_divs[0] == tte_id) selected_divs.pop();
        }
        else {
            var exists_in_list = 0;
            for (x in selected_divs)
                if (tte_id == selected_divs[x])
                    exists_in_list = 1;
            if (exists_in_list) {
                tte_list = selected_divs.join(',');
                var SelectedTTId = $('#timetable_id').val();
                $.get('/Timetable_Entries/update_multiple_timetable_entries2?emp_sub_id=' + emp_sub_id + "&tte_ids=" + tte_id + "&timetable_id=" + SelectedTTId, function (data) {

                    /* data is the pure html returned from action method, load it to your page */
                    $('#modal-box').html(data);
                    /* little fade in effect */
                    $('#modal-box').fadeIn('fast');
                }).success(function (status) {
                    $(".LoaderBox2").hide();
                    clear_selected_divs();
                });
                selected_divs = [];
            }
            else
                var SelectedTTId = $('#timetable_id').val();
            $.get('/Timetable_Entries/update_multiple_timetable_entries2?emp_sub_id=' + emp_sub_id + "&tte_ids=" + tte_id + "&timetable_id=" + SelectedTTId, function (data) {

                /* data is the pure html returned from action method, load it to your page */
                $('#modal-box').html(data);
                /* little fade in effect */
                $('#modal-box').fadeIn('fast');
            }).success(function (status) {
                $(".LoaderBox2").hide();
                clear_selected_divs();
            });
        }
    }
</script>

<div id="content-header">
    <img src="~/Content/images/show_timetable.png" alt="Timetable Logo">
    <h1>Timetable</h1>
    <h3>Create Timetable</h3>
    <div id="app-back-button">
        <a href='javascript:history.back()' onclick="return confirm('are you sure?')"><img src="~/Content/images/buttons/back.png"></a>
    </div>
</div>
<div><img src="~/Content/images/_global/header_underline_.jpg" style="width:100%"></div>

<div id="inner-tab-menu">
    <ul>
        @if (Html.Permitted_To("Subject_Assignment", "Employee"))
        {
            <li><a href="@Url.Action("Subject_Assignment", "Employee")">Employee Subject Association</a></li>
        }
    </ul>
</div>
<div id="page-yield">
    <div class="box">
        @if (ViewBag.Notice != null)
            {
            <p class="flash-msg"> @ViewBag.Notice </p>
        }
        @if (timetable != null && timetable.ID != 0)
        {
            @Html.Hidden("timetable_id", timetable.ID)
        }

        <div class="label-field-pair label">
            <div class="timetable_entry_course_id">@Html.Label("BTCH_ID", "Select A Batch :", htmlAttributes: new { @class = "control-label col-md-2" })</div>
            <div class="text-input-bg">
                @Html.DropDownList("BTCH_ID", null, htmlAttributes: new { @class = "form-control", @id = "BatchDropDown" })
                <div class="LoaderBox"><img src="~/Content/images/loader.gif" id="loader" alt="Finance Logo" style="align-self:center; border:none"></div>
                @Html.ValidationMessage("BTCH_ID", "", new { @class = "text-danger" })
            </div>
        </div>
        <div id="render_area">
            <div>
                @if (ViewBag.Edit == "Edit")
                {
                    using (Html.BeginForm("Update", "Timetable", FormMethod.Post, new { @encType = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        if (timetable != null && timetable.ID != 0)
                        {
                            @Html.Hidden("tt_id", timetable.ID)
                        }
                        <div class="label-field-pair label">
                            <label for="start_date"> Start Date </label>
                            <div class="text-input-bg">
                                @Html.Editor("START_DATE", new { htmlAttributes = new { @class = "m-wrap  datepicker", @id = "datepicker" } })
                            </div>
                        </div>
                        <div class="label-field-pair label">
                            <label for="start_date"> End Date </label>
                            <div class="text-input-bg">
                                @Html.Editor("END_DATE", new { htmlAttributes = new { @class = "m-wrap  datepicker", @id = "datepicker2" } })
                            </div>
                        </div>
                        <input type="submit" value="► Create" class="submit_button" />
                    }
                }
            </div>
        </div>
    </div>
</div>
<input type="hidden" value="@Model.ID" id="timetable_id" name="timetable_id" />

